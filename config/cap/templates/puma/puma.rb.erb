directory "<%=current_path%>"
environment "production"
daemonize true

pidfile '<%="#{shared_path}/pids/puma.pid"%>'
state_path '<%="#{shared_path}/pids/puma.state"%>'
stdout_redirect "<%="#{shared_path}/log/puma.stdout.log"%>", "<%="#{shared_path}/log/puma.stderr.log"%>", true

threads 0, 4
bind "<%="tcp://#{app_servers[get_current_host.to_sym][:host]}:#{app_servers[get_current_host.to_sym][:port]}"%>"
workers 2

preload_app!

on_worker_boot do
  ActiveSupport.on_load(:active_record) do
    ActiveRecord::Base.establish_connection
  end
end
